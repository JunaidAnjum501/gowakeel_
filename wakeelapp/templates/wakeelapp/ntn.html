{% extends "wakeelapp/zakatcalculator.html" %} {% load static %}
{% block title %}<title>NTN Status Finder - Check National Tax Number Status | GoWakeel</title>{% endblock title %}
{% block metatitle %}<meta name="description" content="Check your NTN (National Tax Number) status online. Verify registration details, tax status, and download information as PDF with GoWakeel's NTN Status Finder.">{% endblock metatitle %}

{% block Content %}
<section class="py-12 bg-gradient-to-r from-white to-[#003366]/5 dark:from-gray-900 dark:to-gray-800 transition-colors duration-300">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Page Header -->
    <div class="text-center mb-10">
      <h1 class="text-3xl md:text-4xl font-bold text-[#003366] dark:text-blue-300 mb-4 transition-colors duration-300">
        <i class="fas fa-id-card mr-2"></i>NTN Status Finder
      </h1>
      <p class="text-gray-600 dark:text-gray-300 max-w-3xl mx-auto transition-colors duration-300">Check your National Tax Number (NTN) status and details instantly. Enter your CNIC number below to verify registration information.</p>
    </div>


    <!-- Search Card -->
    <div class="max-w-xl mx-auto bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-[#003366]/10 dark:border-blue-900/30 mb-8 transition-colors duration-300">
      <h2 class="text-xl font-bold text-[#003366] dark:text-blue-300 mb-4 flex items-center transition-colors duration-300">
        <i class="fas fa-search mr-2"></i> Find NTN Status
      </h2>
      <div class="space-y-4">
        <div>
          <label for="cnicInput" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 transition-colors duration-300">CNIC Number</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-id-card text-gray-400 dark:text-gray-500 transition-colors duration-300"></i>
            </div>
            <input
              id="cnicInput"
              type="text"
              placeholder="Enter 13-digit CNIC without dashes"
              class="pl-10 w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-[#003366] dark:focus:ring-blue-500 focus:border-[#003366] dark:focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors duration-300"
              maxlength="13"
              pattern="[0-9]{13}"
            />
          </div>
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 transition-colors duration-300">Example: 1234567890123</p>
        </div>
        
        <div class="flex space-x-2">
          <button
            onclick="searchCNIC()"
            class="flex-1 bg-gradient-to-r from-[#003366] to-[#0066cc] text-white py-3 rounded-lg hover:from-[#002244] hover:to-[#004c99] transition-all duration-300 flex items-center justify-center"
          >
            <i class="fas fa-search mr-2"></i> Search NTN Status
          </button>
          
          <button
            onclick="clearSearch()"
            class="px-4 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-all duration-300 flex items-center justify-center"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <!-- Recent Searches -->
        <div id="recentSearches" class="hidden mt-4">
          <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 transition-colors duration-300">Recent Searches:</p>
          <div id="recentSearchesList" class="flex flex-wrap gap-2">
            <!-- Recent searches will be added here dynamically -->
          </div>
        </div>
        
        <div id="errorMessage" class="hidden p-3 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-lg text-center text-sm transition-colors duration-300"></div>
        <div id="loadingIndicator" class="hidden text-center">
          <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-[#003366] dark:border-blue-400 transition-colors duration-300"></div>
          <p class="text-sm text-gray-600 dark:text-gray-400 mt-2 transition-colors duration-300">Searching...</p>
        </div>
      </div>
    </div>

    <!-- Result Card -->
    <div
      id="resultCard"
      class="max-w-3xl mx-auto bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg mt-6 hidden relative border border-[#003366]/10 dark:border-blue-900/30 transition-colors duration-300"
    >
      <!-- Close Button -->
      <button
        id="close"
        onclick="closeCard()"
        class="absolute top-4 right-4 w-8 h-8 flex items-center cursor-pointer justify-center rounded-full text-white font-bold bg-[#003366] hover:bg-[#002244] dark:bg-blue-600 dark:hover:bg-blue-700 transition-colors duration-300"
      >
        <i class="fas fa-times"></i>
      </button>

      <div class="text-center mb-6">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-[#003366]/10 dark:bg-blue-900/30 rounded-full mb-4 transition-colors duration-300">
          <i class="fas fa-user-check text-[#003366] dark:text-blue-300 text-2xl transition-colors duration-300"></i>
        </div>
        <h2 class="text-2xl font-bold text-[#003366] dark:text-blue-300 transition-colors duration-300">NTN Registration Details</h2>
        <p class="text-gray-500 dark:text-gray-400 transition-colors duration-300">Information retrieved from FBR database</p>
      </div>
      
      <div id="cardContent" class="mt-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-8 text-gray-700 dark:text-gray-300 transition-colors duration-300">
          <div class="border-b dark:border-gray-700 pb-2 transition-colors duration-300">
            <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">Registration No</p>
            <p id="regNo" class="font-medium"></p>
          </div>
          <div class="border-b dark:border-gray-700 pb-2 transition-colors duration-300">
            <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">Reference No</p>
            <p id="refNo" class="font-medium"></p>
          </div>
          <div class="border-b dark:border-gray-700 pb-2 transition-colors duration-300">
            <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">Name</p>
            <p id="name" class="font-medium"></p>
          </div>
          <div class="border-b dark:border-gray-700 pb-2 transition-colors duration-300">
            <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">Category</p>
            <p id="category" class="font-medium"></p>
          </div>
          <div class="border-b dark:border-gray-700 pb-2 transition-colors duration-300">
            <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">Registered for Sales Tax</p>
            <p id="salesTax" class="font-medium"></p>
          </div>
          <div class="border-b dark:border-gray-700 pb-2 transition-colors duration-300">
            <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">PP/REG/INC No</p>
            <p id="ppRegNo" class="font-medium"></p>
          </div>
          <div class="border-b dark:border-gray-700 pb-2 transition-colors duration-300">
            <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">Email</p>
            <p id="email" class="font-medium"></p>
          </div>
          <div class="border-b dark:border-gray-700 pb-2 transition-colors duration-300">
            <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">Cell</p>
            <p id="cell" class="font-medium"></p>
          </div>
          <div class="border-b dark:border-gray-700 pb-2 col-span-2 transition-colors duration-300">
            <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">Address</p>
            <p id="address" class="font-medium"></p>
          </div>
          <div class="border-b dark:border-gray-700 pb-2 transition-colors duration-300">
            <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">Registered On</p>
            <p id="regDate" class="font-medium"></p>
          </div>
          <div class="border-b dark:border-gray-700 pb-2 transition-colors duration-300">
            <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">Tax Office</p>
            <p id="taxOffice" class="font-medium"></p>
          </div>
          <div class="col-span-2 mt-2">
            <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">Registration Status</p>
            <p id="status" class="font-medium text-green-600 dark:text-green-400 transition-colors duration-300"></p>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="mt-6 flex flex-col sm:flex-row justify-center gap-3">
        <button
          id="downloadPdf"
          onclick="downloadPDF()"
          class="px-6 py-3 bg-[#003366] dark:bg-blue-600 text-white rounded-lg hover:bg-[#002244] dark:hover:bg-blue-700 transition-all duration-300 flex items-center justify-center"
        >
          <i class="fas fa-file-pdf mr-2"></i> Download as PDF
        </button>
        
        <button
          onclick="saveSearch()"
          class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-all duration-300 flex items-center justify-center"
        >
          <i class="fas fa-bookmark mr-2"></i> Save Result
        </button>
        
        <button
          onclick="shareResult()"
          class="px-6 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all duration-300 flex items-center justify-center"
        >
          <i class="fas fa-share-alt mr-2"></i> Share
        </button>
      </div>
    </div>

    <!-- Saved Results Section -->
    <div id="savedResultsSection" class="max-w-3xl mx-auto mt-8 hidden">
      <h3 class="text-xl font-bold text-[#003366] dark:text-blue-300 mb-4 transition-colors duration-300">
        <i class="fas fa-bookmark mr-2"></i> Saved Results
      </h3>
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md border border-[#003366]/10 dark:border-blue-900/30 overflow-hidden transition-colors duration-300">
        <div id="noSavedResults" class="p-6 text-center text-gray-500 dark:text-gray-400 transition-colors duration-300">
          <i class="fas fa-info-circle text-2xl mb-2"></i>
          <p>No saved results yet.</p>
        </div>
        <div id="savedResultsList" class="hidden divide-y divide-gray-200 dark:divide-gray-700 transition-colors duration-300">
          <!-- Saved results will be added here dynamically -->
        </div>
      </div>
    </div>

    <!-- Information Sections -->
    <div class="mt-16 grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Benefits Section -->
      <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-[#003366]/10 dark:border-blue-900/30 transition-colors duration-300">
        <h2 class="text-2xl font-bold text-[#003366] dark:text-blue-300 mb-4 flex items-center transition-colors duration-300">
          <i class="fas fa-check-circle mr-2 text-[#003366] dark:text-blue-300 transition-colors duration-300"></i> Benefits of having NTN
        </h2>
        <ul class="space-y-3 text-gray-700 dark:text-gray-300 transition-colors duration-300">
          <li class="flex items-start">
            <i class="fas fa-check text-green-500 dark:text-green-400 mt-1 mr-2 transition-colors duration-300"></i>
            <span><strong>Tax Savings:</strong> Claim tax credits for investments and adjust taxes paid on utilities, vehicles, property transactions, and cash withdrawals.</span>
          </li>
          <li class="flex items-start">
            <i class="fas fa-check text-green-500 dark:text-green-400 mt-1 mr-2 transition-colors duration-300"></i>
            <span><strong>Lower Withholding Tax:</strong> Non-filers are subject to higher rates of taxes on various transactions.</span>
          </li>
          <li class="flex items-start">
            <i class="fas fa-check text-green-500 dark:text-green-400 mt-1 mr-2 transition-colors duration-300"></i>
            <span><strong>Avoid Penalties:</strong> Be a responsible citizen and avoid penalties and/or prosecutions from the FBR for not filing returns.</span>
          </li>
          <li class="flex items-start">
            <i class="fas fa-check text-green-500 dark:text-green-400 mt-1 mr-2 transition-colors duration-300"></i>
            <span><strong>Compliance Check:</strong> Many government organizations and banks check your FBR tax filer status before processing requests like company registration, property purchase, and loan processing.</span>
          </li>
        </ul>
      </div>
      
      <!-- How to Apply Section -->
      <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border border-[#003366]/10 dark:border-blue-900/30 transition-colors duration-300">
        <h2 class="text-2xl font-bold text-[#003366] dark:text-blue-300 mb-4 flex items-center transition-colors duration-300">
          <i class="fas fa-file-alt mr-2 text-[#003366] dark:text-blue-300 transition-colors duration-300"></i> How to Apply for NTN
        </h2>
        <ol class="space-y-3 text-gray-700 dark:text-gray-300 list-decimal pl-5 transition-colors duration-300">
          <li class="pl-2">
            <strong><i class="fas fa-laptop mr-1"></i> Online Application:</strong> Visit the FBR IRIS portal and register yourself.
          </li>
          <li class="pl-2">
            <strong><i class="fas fa-copy mr-1"></i> Required Documents:</strong> CNIC copy, utility bills, and other supporting documents.
          </li>
          <li class="pl-2">
            <strong><i class="fas fa-pen-alt mr-1"></i> Form Submission:</strong> Complete the online application form with accurate information.
          </li>
          <li class="pl-2">
            <strong><i class="fas fa-check-double mr-1"></i> Verification:</strong> Your application will be verified by the tax authorities.
          </li>
          <li class="pl-2">
            <strong><i class="fas fa-certificate mr-1"></i> NTN Issuance:</strong> Upon successful verification, your NTN will be issued.
          </li>
        </ol>
        <div class="mt-4">
          <a href="{% url 'wakeelapp:contact' %}" class="inline-flex items-center text-[#003366] dark:text-blue-300 hover:text-[#0066cc] dark:hover:text-blue-400 transition-colors duration-300">
            <i class="fas fa-headset mr-2"></i> Need help with NTN registration? Contact our experts
            <i class="fas fa-arrow-right ml-2"></i>
          </a>
        </div>
      </div>
    </div>
    
    <!-- FAQ Section -->
    <div class="mt-12">
      <h2 class="text-2xl font-bold text-[#003366] dark:text-blue-300 mb-6 text-center transition-colors duration-300">
        <i class="fas fa-question-circle mr-2"></i>Frequently Asked Questions
      </h2>
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md border border-[#003366]/10 dark:border-blue-900/30 overflow-hidden transition-colors duration-300">
        <div class="divide-y divide-gray-200 dark:divide-gray-700 transition-colors duration-300">
          <div class="faq-item">
            <button class="faq-question w-full flex items-center justify-between p-6 text-left focus:outline-none">
              <span class="text-lg font-semibold text-[#003366] dark:text-blue-300 transition-colors duration-300"><i class="fas fa-info-circle mr-2"></i>What is NTN?</span>
              <i class="fas fa-chevron-down text-[#003366] dark:text-blue-300 transform transition-transform duration-300"></i>
            </button>
            <div class="faq-answer px-6 pb-6 hidden">
              <p class="text-gray-700 dark:text-gray-300 transition-colors duration-300">NTN (National Tax Number) is a unique identifier issued by the Federal Board of Revenue (FBR) to taxpayers in Pakistan. It is used for filing tax returns and for various financial transactions.</p>
            </div>
          </div>
          <div class="faq-item">
            <button class="faq-question w-full flex items-center justify-between p-6 text-left focus:outline-none">
              <span class="text-lg font-semibold text-[#003366] dark:text-blue-300 transition-colors duration-300"><i class="fas fa-users mr-2"></i>Who needs to have an NTN?</span>
              <i class="fas fa-chevron-down text-[#003366] dark:text-blue-300 transform transition-transform duration-300"></i>
            </button>
            <div class="faq-answer px-6 pb-6 hidden">
              <p class="text-gray-700 dark:text-gray-300 transition-colors duration-300">All individuals and businesses that earn taxable income in Pakistan are required to have an NTN. This includes salaried individuals, business owners, professionals, and companies.</p>
            </div>
          </div>
          <div class="faq-item">
            <button class="faq-question w-full flex items-center justify-between p-6 text-left focus:outline-none">
              <span class="text-lg font-semibold text-[#003366] dark:text-blue-300 transition-colors duration-300"><i class="fas fa-id-badge mr-2"></i>Is NTN the same as CNIC?</span>
              <i class="fas fa-chevron-down text-[#003366] dark:text-blue-300 transform transition-transform duration-300"></i>
            </button>
            <div class="faq-answer px-6 pb-6 hidden">
              <p class="text-gray-700 dark:text-gray-300 transition-colors duration-300">No, NTN and CNIC are different. CNIC (Computerized National Identity Card) is issued by NADRA for identification purposes, while NTN is issued by FBR specifically for tax purposes. However, for individuals, the NTN is now linked to their CNIC number.</p>
            </div>
          </div>
          <div class="faq-item">
            <button class="faq-question w-full flex items-center justify-between p-6 text-left focus:outline-none">
              <span class="text-lg font-semibold text-[#003366] dark:text-blue-300 transition-colors duration-300"><i class="fas fa-calendar-alt mr-2"></i>How often do I need to renew my NTN?</span>
              <i class="fas fa-chevron-down text-[#003366] dark:text-blue-300 transform transition-transform duration-300"></i>
            </button>
            <div class="faq-answer px-6 pb-6 hidden">
              <p class="text-gray-700 dark:text-gray-300 transition-colors duration-300">NTN does not require renewal. Once issued, it remains valid for life. However, you must file your income tax returns annually to maintain your active taxpayer status.</p>
            </div>
          </div>
          <div class="faq-item">
            <button class="faq-question w-full flex items-center justify-between p-6 text-left focus:outline-none">
              <span class="text-lg font-semibold text-[#003366] dark:text-blue-300 transition-colors duration-300"><i class="fas fa-exclamation-triangle mr-2"></i>What happens if I don't have an NTN?</span>
              <i class="fas fa-chevron-down text-[#003366] dark:text-blue-300 transform transition-transform duration-300"></i>
            </button>
            <div class="faq-answer px-6 pb-6 hidden">
              <p class="text-gray-700 dark:text-gray-300 transition-colors duration-300">Without an NTN, you may face higher withholding tax rates on various transactions such as banking, property, and vehicle purchases. You'll also be unable to claim tax refunds or credits, and may face difficulties in certain financial and business transactions.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Call to Action Section -->
    <div class="mt-16 bg-[#003366] dark:bg-blue-900 rounded-xl p-8 text-center transition-colors duration-300">
      <h2 class="text-2xl font-bold text-white mb-4 transition-colors duration-300">
        <i class="fas fa-hand-point-right mr-2"></i>Need Professional Assistance?
      </h2>
      <p class="text-white/80 max-w-2xl mx-auto mb-6 transition-colors duration-300">Our tax experts can help you with NTN registration, verification, and tax filing services.</p>
      <div class="flex flex-col sm:flex-row justify-center gap-4">
        <a href="{% url 'wakeelapp:contact' %}" class="px-6 py-3 bg-white text-[#003366] font-semibold rounded-lg hover:bg-gray-100 transition-all duration-300 flex items-center justify-center">
          <i class="fas fa-envelope mr-2"></i> Contact Us
        </a>
        <a href="https://wa.me/923369969997?text=I'm%20interested%20in%20NTN%20services" class="px-6 py-3 bg-[#25D366] text-white font-semibold rounded-lg hover:bg-[#128C7E] transition-all duration-300 flex items-center justify-center">
          <i class="fab fa-whatsapp mr-2"></i> WhatsApp Us
        </a>
      </div>
    </div>
  </div>
</section>

<!-- Share Modal -->
<div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
  <div class="bg-white dark:bg-gray-800 rounded-xl p-6 max-w-md w-full mx-4 transition-colors duration-300">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-bold text-[#003366] dark:text-blue-300 transition-colors duration-300">Share NTN Information</h3>
      <button onclick="closeShareModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors duration-300">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="space-y-4">
      <p class="text-gray-700 dark:text-gray-300 text-sm transition-colors duration-300">Share this NTN information via:</p>
      <div class="grid grid-cols-2 gap-3">
        <button onclick="copyShareLink()" class="flex items-center justify-center p-3 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-300">
          <i class="fas fa-link text-gray-700 dark:text-gray-300 mr-2 transition-colors duration-300"></i>
          <span class="text-gray-700 dark:text-gray-300 transition-colors duration-300">Copy Link</span>
        </button>
        <button onclick="shareWhatsApp()" class="flex items-center justify-center p-3 bg-[#25D366] rounded-lg hover:bg-[#128C7E] transition-colors duration-300">
          <i class="fab fa-whatsapp text-white mr-2"></i>
          <span class="text-white">WhatsApp</span>
        </button>
        <button onclick="shareEmail()" class="flex items-center justify-center p-3 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-300">
          <i class="fas fa-envelope text-gray-700 dark:text-gray-300 mr-2 transition-colors duration-300"></i>
          <span class="text-gray-700 dark:text-gray-300 transition-colors duration-300">Email</span>
        </button>
        <button onclick="shareSMS()" class="flex items-center justify-center p-3 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-300">
          <i class="fas fa-sms text-gray-700 dark:text-gray-300 mr-2 transition-colors duration-300"></i>
          <span class="text-gray-700 dark:text-gray-300 transition-colors duration-300">SMS</span>
        </button>
      </div>
      <div id="shareLinkCopied" class="hidden mt-2 p-2 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-sm rounded text-center transition-colors duration-300">
        Link copied to clipboard!
      </div>
    </div>
  </div>
</div>

<script>
  // Sample Data
  const userData = {
    1234567890123: {
      "Registration No": "1234567890123",
      "Reference No": "8456123-2",
      "Registered for Sales Tax": "No",
      Name: "Anwar Ali",
      Category: "Pakistani Male",
      "PP/REG/INC No": "123456789012345",
      Email: "abc@gmail.com",
      Cell: "00923**973**30",
      Address:
        "House 123, Block B, Gulberg III, Lahore",
      "Registered On": "15-02-2023",
      "Tax Office": "RTO LAHORE",
      "Registration Status": "Income Tax: Active",
    },
    // ... other user data
    };
  
    // Initialize dark mode
    document.addEventListener('DOMContentLoaded', function() {
      initDarkMode();
      initFAQAccordion();
      loadRecentSearches();
      loadSavedResults();
    });
  
    // Dark mode functionality
    function initDarkMode() {
      const darkModeToggle = document.getElementById('darkModeToggle');
      
      // Check for saved theme preference or use system preference
      const savedTheme = localStorage.getItem('theme');
      const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      
      // Apply the right theme
      if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
      
      // Toggle dark/light mode
      darkModeToggle.addEventListener('click', function() {
        if (document.documentElement.classList.contains('dark')) {
          document.documentElement.classList.remove('dark');
          localStorage.setItem('theme', 'light');
        } else {
          document.documentElement.classList.add('dark');
          localStorage.setItem('theme', 'dark');
        }
      });
    }
  
    // Initialize FAQ accordion
    function initFAQAccordion() {
      const faqQuestions = document.querySelectorAll('.faq-question');
      
      faqQuestions.forEach(question => {
        question.addEventListener('click', () => {
          const answer = question.nextElementSibling;
          const icon = question.querySelector('i.fa-chevron-down');
          
          // Toggle answer visibility
          if (answer.classList.contains('hidden')) {
            answer.classList.remove('hidden');
            icon.classList.add('rotate-180');
          } else {
            answer.classList.add('hidden');
            icon.classList.remove('rotate-180');
          }
        });
      });
    }
  
    // Function to search CNIC
    function searchCNIC() {
      const cnicInput = document.getElementById("cnicInput").value.trim();
      const errorMessage = document.getElementById("errorMessage");
      const loadingIndicator = document.getElementById("loadingIndicator");
      const resultCard = document.getElementById("resultCard");
      
      // Reset UI
      errorMessage.classList.add("hidden");
      resultCard.classList.add("hidden");
      
      // Validate input
      if (!cnicInput) {
        showError("Please enter a CNIC number");
        return;
      }
      
      if (!/^\d{13}$/.test(cnicInput)) {
        showError("Please enter a valid 13-digit CNIC number without dashes");
        return;
      }
      
      // Show loading
      loadingIndicator.classList.remove("hidden");
      
      // Simulate API call with timeout
      setTimeout(() => {
        loadingIndicator.classList.add("hidden");
        
        if (userData[cnicInput]) {
          displayResult(userData[cnicInput]);
          addToRecentSearches(cnicInput);
        } else {
          showError("No NTN record found for this CNIC. Please verify your CNIC number or contact FBR for assistance.");
        }
      }, 1500);
    }
    
    // Function to display error
    function showError(message) {
      const errorMessage = document.getElementById("errorMessage");
      errorMessage.textContent = message;
      errorMessage.classList.remove("hidden");
    }
    
    // Function to display result
    function displayResult(data) {
      // Populate fields
      document.getElementById("regNo").textContent = data["Registration No"];
      document.getElementById("refNo").textContent = data["Reference No"];
      document.getElementById("name").textContent = data["Name"];
      document.getElementById("category").textContent = data["Category"];
      document.getElementById("salesTax").textContent = data["Registered for Sales Tax"];
      document.getElementById("ppRegNo").textContent = data["PP/REG/INC No"];
      document.getElementById("email").textContent = data["Email"];
      document.getElementById("cell").textContent = data["Cell"];
      document.getElementById("address").textContent = data["Address"];
      document.getElementById("regDate").textContent = data["Registered On"];
      document.getElementById("taxOffice").textContent = data["Tax Office"];
      document.getElementById("status").textContent = data["Registration Status"];
      
      // Show result card
      document.getElementById("resultCard").classList.remove("hidden");
      
      // Scroll to result
      document.getElementById("resultCard").scrollIntoView({ behavior: "smooth", block: "start" });
    }
    
    // Function to close result card
    function closeCard() {
      document.getElementById("resultCard").classList.add("hidden");
      document.getElementById("cnicInput").focus();
    }
    
    // Function to clear search
    function clearSearch() {
      document.getElementById("cnicInput").value = "";
      document.getElementById("errorMessage").classList.add("hidden");
      document.getElementById("resultCard").classList.add("hidden");
      document.getElementById("cnicInput").focus();
    }
    
    // Function to add to recent searches
    function addToRecentSearches(cnic) {
      // Get existing searches
      let recentSearches = JSON.parse(localStorage.getItem('recentSearches')) || [];
      
      // Remove if already exists
      recentSearches = recentSearches.filter(item => item !== cnic);
      
      // Add to beginning of array
      recentSearches.unshift(cnic);
      
      // Keep only the last 5 searches
      if (recentSearches.length > 5) {
        recentSearches = recentSearches.slice(0, 5);
      }
      
      // Save to localStorage
      localStorage.setItem('recentSearches', JSON.stringify(recentSearches));
      
      // Update UI
      loadRecentSearches();
    }
    
    // Function to load recent searches
    function loadRecentSearches() {
      const recentSearches = JSON.parse(localStorage.getItem('recentSearches')) || [];
      const recentSearchesContainer = document.getElementById('recentSearches');
      const recentSearchesList = document.getElementById('recentSearchesList');
      
      if (recentSearches.length > 0) {
        recentSearchesList.innerHTML = '';
        recentSearches.forEach(cnic => {
          const button = document.createElement('button');
          button.className = 'px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-sm transition-colors duration-300';
          button.textContent = formatCNIC(cnic);
          button.onclick = function() {
            document.getElementById('cnicInput').value = cnic;
            searchCNIC();
          };
          recentSearchesList.appendChild(button);
        });
        recentSearchesContainer.classList.remove('hidden');
      } else {
        recentSearchesContainer.classList.add('hidden');
      }
    }
    
    // Format CNIC for display
    function formatCNIC(cnic) {
      return cnic.replace(/^(\d{5})(\d{7})(\d{1})$/, "$1-$2-$3");
    }
    
    // Function to save search result
    function saveSearch() {
      const cnic = document.getElementById("regNo").textContent;
      const name = document.getElementById("name").textContent;
      
      if (!cnic) {
        return;
      }
      
      // Get current data
      const data = {
        id: Date.now(),
        cnic: cnic,
        name: name,
        date: new Date().toLocaleDateString(),
        status: document.getElementById("status").textContent
      };
      
      // Get existing saved results
      let savedResults = JSON.parse(localStorage.getItem('savedNTNResults')) || [];
      
      // Check if already saved
      const alreadySaved = savedResults.some(result => result.cnic === cnic);
      if (alreadySaved) {
        alert('This NTN record is already saved.');
        return;
      }
      
      // Add to saved results
      savedResults.push(data);
      
      // Save to localStorage
      localStorage.setItem('savedNTNResults', JSON.stringify(savedResults));
      
      // Update UI
      loadSavedResults();
      
      // Show saved results section
      document.getElementById("savedResultsSection").classList.remove("hidden");
      
      // Show notification
      alert('NTN record saved successfully!');
    }
    
    // Function to load saved results
    function loadSavedResults() {
      const savedResults = JSON.parse(localStorage.getItem('savedNTNResults')) || [];
      const noSavedResults = document.getElementById('noSavedResults');
      const savedResultsList = document.getElementById('savedResultsList');
      const savedResultsSection = document.getElementById('savedResultsSection');
      
      if (savedResults.length > 0) {
        savedResultsSection.classList.remove('hidden');
        noSavedResults.classList.add('hidden');
        savedResultsList.classList.remove('hidden');
        
        // Clear existing list
        savedResultsList.innerHTML = '';
        
        // Add each saved result
        savedResults.forEach(result => {
          const item = document.createElement('div');
          item.className = 'p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors duration-300';
          item.innerHTML = `
            <div class="flex justify-between items-center">
              <div>
                <h4 class="font-medium text-gray-800 dark:text-gray-200 transition-colors duration-300">${result.name}</h4>
                <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">CNIC: ${formatCNIC(result.cnic)}</p>
                <p class="text-sm text-gray-500 dark:text-gray-400 transition-colors duration-300">Saved on: ${result.date}</p>
                <span class="inline-block mt-1 px-2 py-1 text-xs rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 transition-colors duration-300">${result.status}</span>
              </div>
              <div class="flex space-x-2">
                <button onclick="loadSavedResult('${result.cnic}')" class="p-2 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors duration-300">
                  <i class="fas fa-eye"></i>
                </button>
                <button onclick="deleteSavedResult(${result.id})" class="p-2 text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 transition-colors duration-300">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </div>
          `;
          savedResultsList.appendChild(item);
        });
      } else {
        if (savedResultsSection.classList.contains('hidden')) {
          savedResultsSection.classList.add('hidden');
        } else {
          noSavedResults.classList.remove('hidden');
          savedResultsList.classList.add('hidden');
        }
      }
    }
    
    // Function to load a saved result
    function loadSavedResult(cnic) {
      document.getElementById('cnicInput').value = cnic;
      searchCNIC();
    }
    
    // Function to delete a saved result
    function deleteSavedResult(id) {
      if (confirm('Are you sure you want to delete this saved record?')) {
        // Get existing saved results
        let savedResults = JSON.parse(localStorage.getItem('savedNTNResults')) || [];
        
        // Filter out the one to delete
        savedResults = savedResults.filter(result => result.id !== id);
        
        // Save back to localStorage
        localStorage.setItem('savedNTNResults', JSON.stringify(savedResults));
        
        // Update UI
        loadSavedResults();
      }
    }
    
    // Function to download PDF
    function downloadPDF() {
      // Get data from displayed result
      const name = document.getElementById("name").textContent;
      const regNo = document.getElementById("regNo").textContent;
      const status = document.getElementById("status").textContent;
      
      // Create a new window for PDF
      const printWindow = window.open('', '', 'height=650,width=900');
      printWindow.document.write('<html><head><title>NTN Certificate</title>');
      
      // Add styles
      printWindow.document.write(`
        <style>
          body { font-family: Arial, sans-serif; margin: 0; padding: 20px; }
          .certificate { max-width: 800px; margin: 0 auto; border: 2px solid #003366; padding: 30px; }
          .header { text-align: center; margin-bottom: 30px; }
          .logo { font-size: 24px; font-weight: bold; color: #003366; margin-bottom: 10px; }
          h1 { color: #003366; margin-bottom: 20px; }
          .content { margin-bottom: 30px; }
          .info-row { display: flex; margin-bottom: 10px; }
          .label { font-weight: bold; width: 200px; }
          .value { flex: 1; }
          .footer { margin-top: 50px; text-align: center; font-size: 12px; color: #666; }
          .status { margin-top: 20px; padding: 10px; background-color: #e6f7e6; border-radius: 5px; color: #2e7d32; font-weight: bold; }
          @media print {
            body { -webkit-print-color-adjust: exact; }
          }
        </style>
      `);
      
      printWindow.document.write('</head><body>');
      
      // Certificate content
      printWindow.document.write(`
        <div class="certificate">
          <div class="header">
            <div class="logo">GoWakeel</div>
            <h1>NTN Registration Certificate</h1>
            <p>This document confirms the NTN registration status as retrieved from FBR database</p>
          </div>
          
          <div class="content">
            <div class="info-row">
              <div class="label">Name:</div>
              <div class="value">${document.getElementById("name").textContent}</div>
            </div>
            <div class="info-row">
              <div class="label">Registration No:</div>
              <div class="value">${document.getElementById("regNo").textContent}</div>
            </div>
            <div class="info-row">
              <div class="label">Reference No:</div>
              <div class="value">${document.getElementById("refNo").textContent}</div>
            </div>
            <div class="info-row">
              <div class="label">Category:</div>
              <div class="value">${document.getElementById("category").textContent}</div>
            </div>
            <div class="info-row">
              <div class="label">Registered for Sales Tax:</div>
              <div class="value">${document.getElementById("salesTax").textContent}</div>
            </div>
            <div class="info-row">
              <div class="label">Address:</div>
              <div class="value">${document.getElementById("address").textContent}</div>
            </div>
            <div class="info-row">
              <div class="label">Registered On:</div>
              <div class="value">${document.getElementById("regDate").textContent}</div>
            </div>
            <div class="info-row">
              <div class="label">Tax Office:</div>
              <div class="value">${document.getElementById("taxOffice").textContent}</div>
            </div>
            
            <div class="status">
              ${document.getElementById("status").textContent}
            </div>
          </div>
          
          <div class="footer">
            <p>This certificate was generated on ${new Date().toLocaleDateString()} using GoWakeel NTN Status Finder</p>
            <p>For verification, please visit the FBR official website or contact your nearest tax office.</p>
          </div>
        </div>
      `);
      
      printWindow.document.write('</body></html>');
      printWindow.document.close();
      
      // Wait for content to load then print
      printWindow.onload = function() {
        printWindow.focus();
        printWindow.print();
        printWindow.close();
      };
    }
    
    // Share functionality
    function shareResult() {
      document.getElementById('shareModal').classList.remove('hidden');
    }
    
    function closeShareModal() {
      document.getElementById('shareModal').classList.add('hidden');
      document.getElementById('shareLinkCopied').classList.add('hidden');
    }
    
    function copyShareLink() {
      const name = document.getElementById("name").textContent;
      const regNo = document.getElementById("regNo").textContent;
      const status = document.getElementById("status").textContent;
      
      // Create share text
      const shareText = `NTN Information for ${name} (${regNo}): ${status}. Check more details at GoWakeel NTN Status Finder.`;
      
      // Copy to clipboard
      navigator.clipboard.writeText(shareText).then(() => {
        document.getElementById('shareLinkCopied').classList.remove('hidden');
        setTimeout(() => {
          document.getElementById('shareLinkCopied').classList.add('hidden');
        }, 3000);
      });
    }
    
    function shareWhatsApp() {
      const name = document.getElementById("name").textContent;
      const regNo = document.getElementById("regNo").textContent;
      const status = document.getElementById("status").textContent;
      
      const shareText = `NTN Information for ${name} (${regNo}): ${status}. Check more details at GoWakeel NTN Status Finder.`;
      const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(shareText)}`;
      
      window.open(whatsappUrl, '_blank');
    }
    
    function shareEmail() {
      const name = document.getElementById("name").textContent;
      const regNo = document.getElementById("regNo").textContent;
      const status = document.getElementById("status").textContent;
      
      const subject = `NTN Information for ${name}`;
      const body = `NTN Information for ${name} (${regNo}):\n\nRegistration Status: ${status}\n\nCheck more details at GoWakeel NTN Status Finder.`;
      
      window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }
    
    function shareSMS() {
      const name = document.getElementById("name").textContent;
      const regNo = document.getElementById("regNo").textContent;
      const status = document.getElementById("status").textContent;
      
      const smsText = `NTN Information for ${name} (${regNo}): ${status}. Check more details at GoWakeel NTN Status Finder.`;
      
      window.location.href = `sms:?body=${encodeURIComponent(smsText)}`;
    }
  </script>
  {% endblock Content %}