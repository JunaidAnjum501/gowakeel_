{% extends "wakeelapp/zakatcalculator.html" %} {% load static %}
{% block title %}<title>Currency Converter - GoWakeel</title>{% endblock title %}
{% block metatitle %}<meta name="description" content="Convert between different currencies with our free online currency converter. Get real-time exchange rates.">{% endblock metatitle %}
{% block Content %}

<!-- Hero Section -->
<div class="bg-gradient-to-r from-[#003366]/5 to-white py-8">
  <div class="max-w-7xl mx-auto px-6">
    <div class="text-center">
      <h1 class="text-3xl md:text-4xl font-bold text-[#003366] mb-2">
        Currency Converter
      </h1>
      <div class="h-1 w-20 bg-[#003366] mb-4 mx-auto"></div>
      <p class="text-gray-700 max-w-2xl mx-auto">
        Convert between 150+ currencies with real-time exchange rates. Perfect for travel planning, business, or personal finance.
      </p>
    </div>
  </div>
</div>

<section class="w-container max-w-7xl mx-auto my-8 px-4">
  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
    <!-- Converter Card -->
    <div class="md:col-span-2">
      <div class="bg-white p-6 rounded-lg shadow-lg border border-gray-200">
        <h2 class="text-2xl font-bold mb-6 text-[#003366] flex items-center">
          <i class="fas fa-exchange-alt mr-3 text-[#003366]/70"></i>
          Currency Converter
        </h2>

        <div id="loading-currencies" class="text-center py-8">
          <div class="inline-block animate-spin rounded-full h-10 w-10 border-b-2 border-[#003366]"></div>
          <p class="mt-3 text-gray-600">Loading currencies...</p>
        </div>

        <div id="converter-form" class="hidden">
          <!-- Amount Input -->
          <div class="mb-6">
            <label for="amount" class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
            <div class="relative">
              <input
                type="number"
                id="amount"
                class="w-full p-3 pl-10 border border-gray-300 rounded-lg mt-1 focus:ring-2 focus:ring-[#003366] focus:border-[#003366] focus:outline-none text-lg"
                placeholder="Enter amount"
                value="1"
              />
              <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <i class="fas fa-coins text-[#003366]"></i>
              </div>
            </div>
          </div>

          <!-- Currency Selection -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
              <label for="from" class="block text-sm font-medium text-gray-700 mb-2">From Currency</label>
              <div class="relative">
                <select
                  id="from"
                  class="w-full p-3 pl-10 border border-gray-300 rounded-lg mt-1 focus:ring-2 focus:ring-[#003366] focus:border-[#003366] focus:outline-none appearance-none bg-white"
                ></select>
                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                  <i class="fas fa-globe text-[#003366]"></i>
                </div>
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                  <i class="fas fa-chevron-down text-gray-400"></i>
                </div>
              </div>
            </div>

            <div>
              <label for="to" class="block text-sm font-medium text-gray-700 mb-2">To Currency</label>
              <div class="relative">
                <select
                  id="to"
                  class="w-full p-3 pl-10 border border-gray-300 rounded-lg mt-1 focus:ring-2 focus:ring-[#003366] focus:border-[#003366] focus:outline-none appearance-none bg-white"
                ></select>
                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                  <i class="fas fa-globe text-[#003366]"></i>
                </div>
                <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                  <i class="fas fa-chevron-down text-gray-400"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- Swap Button -->
          <div class="flex justify-center mb-6">
            <button 
              onclick="swapCurrencies()" 
              class="bg-[#003366]/10 text-[#003366] p-3 rounded-full hover:bg-[#003366]/20 transition"
              title="Swap currencies"
            >
              <i class="fas fa-exchange-alt text-lg"></i>
            </button>
          </div>

          <button
            onclick="convertCurrency()"
            class="w-full bg-[#003366] text-white py-3 rounded-lg hover:bg-[#002244] transition duration-300 flex items-center justify-center text-lg"
          >
            <i class="fas fa-sync-alt mr-2"></i> Convert
          </button>

          <div id="api-error" class="mt-6 p-4 text-center border border-red-300 rounded-lg bg-red-50 hidden">
            <p class="text-red-600"></p>
          </div>

          <div
            id="result-container"
            class="mt-6 p-5 text-center border border-gray-300 rounded-lg bg-gradient-to-r from-gray-50 to-white hidden"
          >
            <h3 id="result" class="text-xl font-bold text-[#003366]"></h3>
            <p id="exchange-rate" class="text-sm text-gray-700 mt-2"></p>
            <p id="last-updated" class="text-xs text-gray-500 mt-2"></p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Info Card -->
    <div class="bg-white p-6 rounded-lg shadow-lg border border-gray-200">
      <h3 class="text-xl font-bold mb-4 text-[#003366]">
        <i class="fas fa-info-circle mr-2"></i> About This Tool
      </h3>
      
      <div class="space-y-4">
        <div class="flex items-start">
          <div class="flex-shrink-0 w-8 h-8 bg-[#003366]/10 rounded-full flex items-center justify-center mr-3">
            <i class="fas fa-bolt text-[#003366]"></i>
          </div>
          <div>
            <h4 class="font-semibold text-gray-800">Real-Time Rates</h4>
            <p class="text-sm text-gray-600">Get up-to-date exchange rates from reliable financial data sources.</p>
          </div>
        </div>
        
        <div class="flex items-start">
          <div class="flex-shrink-0 w-8 h-8 bg-[#003366]/10 rounded-full flex items-center justify-center mr-3">
            <i class="fas fa-globe text-[#003366]"></i>
          </div>
          <div>
            <h4 class="font-semibold text-gray-800">150+ Currencies</h4>
            <p class="text-sm text-gray-600">Convert between major and exotic currencies from around the world.</p>
          </div>
        </div>
        
        <div class="flex items-start">
          <div class="flex-shrink-0 w-8 h-8 bg-[#003366]/10 rounded-full flex items-center justify-center mr-3">
            <i class="fas fa-shield-alt text-[#003366]"></i>
          </div>
          <div>
            <h4 class="font-semibold text-gray-800">Secure & Free</h4>
            <p class="text-sm text-gray-600">No registration required. Use our converter as often as you need.</p>
          </div>
        </div>
      </div>
      
      <div class="mt-6 pt-6 border-t border-gray-200">
        <h4 class="font-semibold text-gray-800 mb-2">Popular Conversions</h4>
        <div class="grid grid-cols-2 gap-2">
          <button onclick="setQuickConversion('USD', 'PKR')" class="p-2 text-sm border border-gray-300 rounded hover:bg-gray-100 transition text-left">
            <span class="font-medium">USD to PKR</span>
          </button>
          <button onclick="setQuickConversion('EUR', 'PKR')" class="p-2 text-sm border border-gray-300 rounded hover:bg-gray-100 transition text-left">
            <span class="font-medium">EUR to PKR</span>
          </button>
          <button onclick="setQuickConversion('GBP', 'PKR')" class="p-2 text-sm border border-gray-300 rounded hover:bg-gray-100 transition text-left">
            <span class="font-medium">GBP to PKR</span>
          </button>
          <button onclick="setQuickConversion('SAR', 'PKR')" class="p-2 text-sm border border-gray-300 rounded hover:bg-gray-100 transition text-left">
            <span class="font-medium">SAR to PKR</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Recent Rates Section -->
  <div class="mt-10 bg-white p-6 rounded-lg shadow-lg border border-gray-200">
    <h3 class="text-xl font-bold mb-4 text-[#003366]">
      <i class="fas fa-chart-line mr-2"></i> Recent Exchange Rates
    </h3>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead>
          <tr>
            <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Currency Pair</th>
            <th class="px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Exchange Rate</th>
            <th class="px-6 py-3 bg-gray-50 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Convert</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200" id="recent-rates">
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center" colspan="3">
              <div class="inline-block animate-spin rounded-full h-5 w-5 border-b-2 border-[#003366]"></div>
              <span class="ml-2">Loading rates...</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<script>
  const apiKey = "sk_f72dBc50967d40EdE688A5d02656A2d574513118506DcC3b";
  const headers = new Headers();
  headers.append("x-api-key", apiKey);
  
  // Initialize the page
  document.addEventListener('DOMContentLoaded', function() {
    fetchCurrencies();
    loadRecentRates();
  });

  function fetchCurrencies() {
    const loadingElement = document.getElementById("loading-currencies");
    const formElement = document.getElementById("converter-form");
    const errorElement = document.getElementById("api-error");
    
    loadingElement.classList.remove("hidden");
    formElement.classList.add("hidden");
    errorElement.classList.add("hidden");
    
    fetch("https://currency-converter.g.apised.com/v1/supported-currencies", {
      method: "GET",
      headers,
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then((data) => {
        if (!data || !data.data) {
          throw new Error("Invalid API response format");
        }

        const currencies = data.data;
        const fromSelect = document.getElementById("from");
        const toSelect = document.getElementById("to");
        
        // Clear existing options
        fromSelect.innerHTML = "";
        toSelect.innerHTML = "";

        // Sort currencies alphabetically by name
        currencies.sort((a, b) => a.currency_name.localeCompare(b.currency_name));

        // Add popular currencies at the top
        const popularCurrencies = ["USD", "EUR", "GBP", "PKR", "SAR", "AED"];
        
        // Create option groups
        const popularGroup = document.createElement("optgroup");
        popularGroup.label = "Popular Currencies";
        
        const otherGroup = document.createElement("optgroup");
        otherGroup.label = "All Currencies";
        
        currencies.forEach((currency) => {
          let option = new Option(
            `${currency.currency_name} (${currency.currency_code})`,
            currency.currency_code
          );
          
          if (popularCurrencies.includes(currency.currency_code)) {
            popularGroup.appendChild(option.cloneNode(true));
          } else {
            otherGroup.appendChild(option.cloneNode(true));
          }
        });
        
        // Add option groups to selects
        fromSelect.appendChild(popularGroup.cloneNode(true));
        fromSelect.appendChild(otherGroup.cloneNode(true));
        
        toSelect.appendChild(popularGroup.cloneNode(true));
        toSelect.appendChild(otherGroup.cloneNode(true));
        
        // Set default values
        setDefaultCurrencies();
        
        // Show the form
        loadingElement.classList.add("hidden");
        formElement.classList.remove("hidden");
      })
      .catch((error) => {
        console.error("Error fetching currencies:", error);
        loadingElement.classList.add("hidden");
        formElement.classList.remove("hidden");
        
        // Show error message
        errorElement.classList.remove("hidden");
        errorElement.querySelector("p").textContent = 
          "Unable to load currencies. Please try again later or use the default values.";
          
        // Load fallback currencies
        loadFallbackCurrencies();
      });
  }
  
  function loadFallbackCurrencies() {
    const fromSelect = document.getElementById("from");
    const toSelect = document.getElementById("to");
    
    // Clear existing options
    fromSelect.innerHTML = "";
    toSelect.innerHTML = "";
    
    // Add some common currencies as fallback
    const fallbackCurrencies = [
      { code: "USD", name: "US Dollar" },
      { code: "EUR", name: "Euro" },
      { code: "GBP", name: "British Pound" },
      { code: "PKR", name: "Pakistani Rupee" },
      { code: "AED", name: "UAE Dirham" },
      { code: "SAR", name: "Saudi Riyal" },
      { code: "CAD", name: "Canadian Dollar" },
      { code: "AUD", name: "Australian Dollar" },
      { code: "JPY", name: "Japanese Yen" },
      { code: "INR", name: "Indian Rupee" }
    ];
    
    fallbackCurrencies.forEach(currency => {
      let option = new Option(
        `${currency.name} (${currency.code})`,
        currency.code
      );
      fromSelect.add(option.cloneNode(true));
      toSelect.add(option);
    });
    
    setDefaultCurrencies();
  }
  
  function setDefaultCurrencies() {
    // Set default values (USD to PKR)
    const fromSelect = document.getElementById("from");
    const toSelect = document.getElementById("to");
    
    // Try to set USD as default "from" currency
    for (let i = 0; i < fromSelect.options.length; i++) {
      if (fromSelect.options[i].value === "USD") {
        fromSelect.selectedIndex = i;
        break;
      }
    }
    
    // Try to set PKR as default "to" currency
    for (let i = 0; i < toSelect.options.length; i++) {
      if (toSelect.options[i].value === "PKR") {
        toSelect.selectedIndex = i;
        break;
      }
    }
  }

  function swapCurrencies() {
    const fromSelect = document.getElementById("from");
    const toSelect = document.getElementById("to");
    
    const tempValue = fromSelect.value;
    const tempIndex = fromSelect.selectedIndex;
    
    // Find the equivalent option in the other select
    for (let i = 0; i < fromSelect.options.length; i++) {
      if (fromSelect.options[i].value === toSelect.value) {
        fromSelect.selectedIndex = i;
        break;
      }
    }
    
    for (let i = 0; i < toSelect.options.length; i++) {
      if (toSelect.options[i].value === tempValue) {
        toSelect.selectedIndex = i;
        break;
      }
    }
    
    // If we already have a result, update it
    if (!document.getElementById("result-container").classList.contains("hidden")) {
      convertCurrency();
    }
  }
  
  function setQuickConversion(fromCurrency, toCurrency) {
    const fromSelect = document.getElementById("from");
    const toSelect = document.getElementById("to");
    
    // Set the "from" currency
    for (let i = 0; i < fromSelect.options.length; i++) {
      if (fromSelect.options[i].value === fromCurrency) {
        fromSelect.selectedIndex = i;
        break;
      }
    }
    
    // Set the "to" currency
    for (let i = 0; i < toSelect.options.length; i++) {
      if (toSelect.options[i].value === toCurrency) {
        toSelect.selectedIndex = i;
        break;
      }
    }
    
    // Trigger conversion
    convertCurrency();
  }

  function convertCurrency() {
    const amount = document.getElementById("amount").value;
    const from = document.getElementById("from").value;
    const to = document.getElementById("to").value;
    const resultContainer = document.getElementById("result-container");
    const apiError = document.getElementById("api-error");
    
    // Validate input
    if (!amount || amount <= 0 || !from || !to) {
      apiError.classList.remove("hidden");
      apiError.querySelector("p").textContent = "Please enter a valid amount and select currencies.";
      return;
    }
    
    // Hide previous results and errors
    resultContainer.classList.add("hidden");
    apiError.classList.add("hidden");
    
    // Show loading in the result container
    resultContainer.innerHTML = `
      <div class="flex justify-center items-center py-4">
        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-[#003366]"></div>
        <span class="ml-2 text-gray-600">Converting...</span>
      </div>
    `;
    resultContainer.classList.remove("hidden");

    fetch(
      `https://currency-converter.g.apised.com/v1/convert?from=${from}&to=${to}&amount=${amount}`,
      { method: "GET", headers }
    )
      .then((response) => {
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then((data) => {
        if (!data || !data.data) {
          throw new Error("Invalid API response format");
        }
        
        const convertedAmount = data.data.convertedAmount;
        const exchangeRate = convertedAmount / amount;
        const currentDate = new Date().toLocaleString();
        
        // Format the result with proper decimal places
        const formattedAmount = parseFloat(amount).toLocaleString(undefined, {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        });
        
        const formattedResult = convertedAmount.toLocaleString(undefined, {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2
        });
        
        // Update the result container
        resultContainer.innerHTML = `
          <h3 id="result" class="text-xl font-bold text-[#003366]">
            ${formattedAmount} ${from} = ${formattedResult} ${to}
          </h3>
          <p id="exchange-rate" class="text-sm text-gray-700 mt-2">
            Exchange Rate: 1 ${from} = ${exchangeRate.toFixed(4)} ${to}
          </p>
          <p id="last-updated" class="text-xs text-gray-500 mt-2">
            Last updated: ${currentDate}
          </p>
        `;
      })
      .catch((error) => {
        console.error("Error converting currency:", error);
        
        // Show error message
        resultContainer.classList.add("hidden");
        apiError.classList.remove("hidden");
        apiError.querySelector("p").textContent = 
          "Unable to convert currency. Please try again later.";
      });
  }
  
  function loadRecentRates() {
    const recentRatesElement = document.getElementById("recent-rates");
    const popularPairs = [
      { from: "USD", to: "PKR" },
      { from: "EUR", to: "PKR" },
      { from: "GBP", to: "PKR" },
      { from: "SAR", to: "PKR" },
      { from: "AED", to: "PKR" }
    ];
    
    // Clear loading indicator
    recentRatesElement.innerHTML = "";
    
    // Create a promise for each currency pair
    const fetchPromises = popularPairs.map(pair => {
      return fetch(
        `https://currency-converter.g.apised.com/v1/convert?from=${pair.from}&to=${pair.to}&amount=1`,
        { method: "GET", headers }
      )
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (!data || !data.data) {
            throw new Error("Invalid API response format");
          }
          return {
            from: pair.from,
            to: pair.to,
            rate: data.data.convertedAmount
          };
        })
        .catch(error => {
          console.error(`Error fetching rate for ${pair.from} to ${pair.to}:`, error);
          return {
            from: pair.from,
            to: pair.to,
            rate: "Error"
          };
        });
    });
    
    // Wait for all promises to resolve
    Promise.all(fetchPromises)
      .then(results => {
        results.forEach(result => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="px-6 py-4 whitespace-nowrap">
              <div class="flex items-center">
                <span class="font-medium text-gray-900">${result.from}</span>
                <span class="mx-2 text-gray-500">to</span>
                <span class="font-medium text-gray-900">${result.to}</span>
              </div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right">
              <span class="font-medium ${result.rate === "Error" ? "text-red-600" : "text-gray-900"}">
                ${result.rate === "Error" ? "Unavailable" : result.rate.toFixed(4)}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right">
              <button 
                onclick="setQuickConversion('${result.from}', '${result.to}')" 
                class="text-[#003366] hover:text-[#002244] font-medium"
                ${result.rate === "Error" ? "disabled" : ""}
              >
                <i class="fas fa-exchange-alt mr-1"></i> Convert
              </button>
            </td>
          `;
          recentRatesElement.appendChild(row);
        });
      })
      .catch(error => {
        console.error("Error loading recent rates:", error);
        recentRatesElement.innerHTML = `
          <tr>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-red-600 text-center" colspan="3">
              Unable to load recent rates. Please try again later.
            </td>
          </tr>
        `;
      });
  }
  
  // Add event listener for Enter key on amount input
  document.getElementById("amount").addEventListener("keyup", function(event) {
    if (event.key === "Enter") {
      convertCurrency();
    }
  });
</script>

{% endblock Content %}